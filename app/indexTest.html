<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="stylesheet.css">
<title> WEATHERVIZ BETA </title>
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="libs/Three.min.js"></script>
<script src="libs/ShaderParticles.min.js"></script>
<script src="libs/dat.gui.min.js"></script>
<script src="libs/helvetiker_regular.typeface.js"></script>
<script src="js/sheets.js"></script>
</head>

<body>


<form id="zipcode_form" class="form">
<label for="zipcode">zipcode</label>
<input type="text" id="zipcode" class="blinker" style="width: 100px;">
</form>

<div id="threeJSContainer"> </div>

<script>




  //get literal description of forecast
  //  add days of the week
  // add type of weather
  // add audio
  function makeSheets(data) {

    for (var i = 0; i < data['forecast']['txt_forecast']
    ['forecastday'].length; i+=2 ) {

        sheets.text.push(data['forecast']['txt_forecast']['forecastday'][i]['fcttext']);
        sheets.day.push(data['forecast']['txt_forecast']['forecastday'][i]['title']);
        sheets.weatherType.push(data['forecast']['txt_forecast']['forecastday'][i]['icon']);
    }


    for (var i = 0; i < sheets.weatherType.length; i++ ) {

         if (sheets.weatherType[i] == "chanceflurries") {
            sheets.weatherAudio[i] = "snow.mp3";
            sheets.weatherGfx[i] = "snow";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "chancerain") {
            sheets.weatherAudio[i] = "heavyRain.mp3";
            sheets.weatherGfx[i] = "rain";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "chancesleet") {
            sheets.weatherAudio[i] = "snow.mp3";
            sheets.weatherGfx[i] = "snow";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "chancesnow") {
            sheets.weatherAudio[i] = "snow.mp3";
            sheets.weatherGfx[i] = "snow";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "chancetstorms") {
            sheets.weatherAudio[i] = "thunderstorm.mp3";
            sheets.weatherGfx[i] = "thunderstorm";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "clear") {
            sheets.weatherAudio[i] = "clear.mp3";
            sheets.weatherGfx[i] = "clear";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "cloudy") {
            sheets.weatherAudio[i] = "clear.mp3";
            sheets.weatherGfx[i] = "cloudy";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] == "flurries") {
            sheets.weatherAudio[i] = "snow.mp3";
            sheets.weatherGfx[i] = "snow";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "drizzle") {
            sheets.weatherAudio[i] = "drizzle.mp3";
            sheets.weatherGfx[i] = "rain";
            console.log(sheets.weatherAudio[i]);


        } else if (sheets.weatherType[i] === "fog") {
            sheets.weatherAudio[i] = "clear.mp3";
            sheets.weatherGfx[i] = "fog";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "hazy") {
            sheets.weatherAudio[i] = "clear.mp3";
            sheets.weatherGfx[i] = "clear";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "mostlycloudy") {
          sheets.weatherAudio[i] = "clear.mp3";
          sheets.weatherGfx[i] = "cloudy";
          console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "mostlysunny") {
          sheets.weatherAudio[i] = "clear.mp3";
          sheets.weatherGfx[i] = "clear";
          console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "partlycloudy") {
          sheets.weatherAudio[i] = "clear.mp3";
          sheets.weatherGfx[i] = "cloudy";
          console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "partlysunny") {
          sheets.weatherAudio[i] = "clear.mp3";
          sheets.weatherGfx[i] = "clear";
          console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "sleet") {
            sheets.weatherAudio[i] = "snow.mp3";
            sheets.weatherGfx[i] = "snow";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "rain") {
            sheets.weatherAudio[i] = "heavyRain.mp3";
            sheets.weatherGfx[i] = "rain";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "snow") {
            sheets.weatherAudio[i] = "snow.mp3";
            sheets.weatherGfx[i] = "snow";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "sunny") {
            sheets.weatherAudio[i] = "clear.mp3";
            sheets.weatherGfx[i] = "clear";
            console.log(sheets.weatherAudio[i]);

        } else if (sheets.weatherType[i] === "tstorms") {
            sheets.weatherAudio[i] = "thunderstorm.mp3";
            sheets.weatherGfx[i] = "thunderstorm";
            console.log(sheets.weatherAudio[i]);

        } else {
          sheets.weatherAudio[i] = "No matching weather pattern at" + [i];
          sheets.weatherGfx[i] = "No matching weather pattern at" + [i];
          console.log(sheets.weatherAudio[i]);
        }

    }

    //once we know the weather, assign webGL too
    //assignGFX();
  }

//add WebGL particles
  function addWebGL() {
    console.log(sheets);
    for (var i = 0; i < sheets.weatherType.length; i++ ) {
    //var num = "plane" + [i + 1];
    if (sheets.weatherGfx[i] === "snow") {
      console.log(sheets.plane[i]);
      initSnowParticles(sheets.plane[i]);

    } else if (sheets.weatherGfx[i] === "clear") {
      weatherSheet = "plane" + [i];
      console.log(sheets.plane[i]);
      initClearParticles(sheets.plane[i]);

    } else if (sheets.weatherGfx[i] === "cloudy") {
      weatherSheet = "plane" + [i];
      console.log(sheets.plane[i]);
      initCloudParticles(sheets.plane[i]);


    } else if (sheets.weatherGfx[i] === "fog") {
      weatherSheet = "plane" + [i];
      console.log(sheets.plane[i]);
      initFogParticles(sheets.plane[i]);


    } else if (sheets.weatherGfx[i] === "thunderstorm") {
      weatherSheet = "plane" + [i];
      console.log(sheets.plane[i]);
      initThunderStormParticles(sheets.plane[i]);

    } else if (sheets.weatherGfx[i] === "rain") {
      initRainParticles(sheets.plane[i]);
    }
  }
}

//on startup
$(function() {

$("#zipcode").focus();

var weatherObj;

//hide this somewhere!
var apiKey = "f71f75cd9e99dbc211c6e48ceaae557c";

//get forecast based on user ZIP

  $('#zipcode_form').submit(function(e) {
    e.preventDefault();

    var zip = $('#zipcode').val();

    if (zip !== "demo") {

      toggleFullScreen();
      $.getJSON('https://api.wunderground.com/api/19e8ddc94141aec0/forecast/q/'
       + zip + '.json', function(data){

      //Make the sheets
      makeSheets(data);

      // //fade in+out
      $('#zipcode_form').hide();


      setTimeout(function(){
      init();
      addWebGL();
      render();
      $('#threeJSContainer').fadeIn(2000);
      }, 2000);
      });

   } else {

     //set full screen
    toggleFullScreen();
    $.getJSON('demo.json', function(data){

        //Make the sheets
        makeSheets(data);

        // //fade in+out
        $('#zipcode_form').hide();

        setTimeout(function(){
        init();
        addWebGL();
        render();
        $('#threeJSContainer').fadeIn(2000);
        }, 2000);
      });
    }
  });
});
</script>
</body>
</html>
